---
import AnimeList from "@components/content/AnimeList.astro";
import Pagination from "@components/ui/Pagination.astro";
import { PAGE_SIZE } from "@constants/constants";
import I18nKey from "@i18n/i18nKey";
import { i18n } from "@i18n/translation";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { getAnimeData } from "@utils/bangumi-utils";
import type { GetStaticPaths } from "astro";
import { Icon } from "astro-icon/components";

export const getStaticPaths = (async ({ paginate }) => {
    const { animeList } = await getAnimeData();

    if (animeList.length === 0) {
        return paginate([null], { pageSize: PAGE_SIZE });
    }

    return paginate(animeList, {
        pageSize: PAGE_SIZE,
    });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

const { stats } = await getAnimeData();
const len = page.data.length;
---

<MainGridLayout title={i18n(I18nKey.anime)}>
    <div
        class="transition flex flex-col rounded-(--radius-large) bg-(--card-bg) py-1 md:py-0 md:bg-transparent mb-4"
    >
        <div
            class="w-full rounded-(--radius-large) p-6 md:p-9 mb-4 md:card-base"
        >
            <div class="relative w-full">
                <div class="mb-6">
                    <h1
                        class="text-4xl font-bold text-black/90 dark:text-white/90 mb-2"
                    >
                        {i18n(I18nKey.animeTitle)}
                    </h1>
                </div>

                <div
                    class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-12"
                    role="group"
                    aria-label="Anime statistics overview"
                >
                    <div
                        class="bg-(--btn-regular-bg) rounded-lg h-10 px-3 flex items-center justify-between font-bold"
                        role="group"
                        aria-label={`Total anime count: ${stats.total}`}
                    >
                        <div class="flex items-center gap-2">
                            <Icon
                                name="material-symbols:bar-chart-4-bars-rounded"
                                class="text-[1.5rem] text-(--primary)"
                                aria-hidden="true"
                            />
                            <span
                                class="text-(--btn-content) dark:text-white/75"
                                >{i18n(I18nKey.animeCountTotal)}</span
                            >
                        </div>
                        <span
                            class="font-bold text-(--btn-content) dark:text-white/75"
                            aria-label={`${stats.total} total anime`}
                            >{stats.total}</span
                        >
                    </div>

                    <div
                        class="bg-(--btn-regular-bg) rounded-lg h-10 px-3 flex items-center justify-between font-bold"
                        role="group"
                        aria-label={`Currently watching anime count: ${stats.watching}`}
                    >
                        <div class="flex items-center gap-2">
                            <Icon
                                name="material-symbols:play-arrow-rounded"
                                class="text-[1.5rem] text-(--primary)"
                                aria-hidden="true"
                            />
                            <span
                                class="text-(--btn-content) dark:text-white/75"
                                >{i18n(I18nKey.animeCountWatching)}</span
                            >
                        </div>
                        <span
                            class="font-bold text-(--btn-content) dark:text-white/75"
                            aria-label={`${stats.watching} currently watching anime`}
                            >{stats.watching}</span
                        >
                    </div>

                    <div
                        class="bg-(--btn-regular-bg) rounded-lg h-10 px-3 flex items-center justify-between font-bold"
                        role="group"
                        aria-label={`Completed anime count: ${stats.completed}`}
                    >
                        <div class="flex items-center gap-2">
                            <Icon
                                name="material-symbols:check-circle-outline-rounded"
                                class="text-[1.5rem] text-(--primary)"
                                aria-hidden="true"
                            />
                            <span
                                class="text-(--btn-content) dark:text-white/75"
                                >{i18n(I18nKey.animeCountCompleted)}</span
                            >
                        </div>
                        <span
                            class="font-bold text-(--btn-content) dark:text-white/75"
                            aria-label={`${stats.completed} completed anime`}
                            >{stats.completed}</span
                        >
                    </div>
                </div>
            </div>
        </div>

        {
            page.data.filter((i) => i !== null).length > 0 && (
                <div class="transition border-t border-dashed mx-6 border-black/10 dark:border-white/15 md:hidden" />
            )
        }

        <AnimeList page={page} />
    </div>

    {
        page.lastPage > 1 && (
            <Pagination
                class="mx-auto onload-animation"
                page={page}
                basePath="anime"
                style={`animation-delay: calc(var(--content-delay) + ${len * 50}ms)`}
            />
        )
    }
</MainGridLayout>
